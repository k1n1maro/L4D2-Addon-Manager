#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–æ–∑–¥–∞–Ω–∏–µ –∫—ç—à–∞ –¥–ª—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–¥–¥–æ–Ω–æ–≤ –∏–∑ –ª–æ–≥–∞
"""

import json
from pathlib import Path
import time

def create_cache_for_unprocessed():
    """–°–æ–∑–¥–∞–µ—Ç –∫—ç—à –¥–ª—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–¥–¥–æ–Ω–æ–≤"""
    
    # –°–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–¥–¥–æ–Ω–æ–≤ –∏–∑ –≤–∞—à–µ–≥–æ –ª–æ–≥–∞
    unprocessed_addons = [
        "3297238909", "3299173209", "3301662235", "3321415041", "3331777868",
        "3350379850", "3380887121", "3382207023", "3391430054", "3391430677", 
        "3391431043", "3391431465", "3416192819", "3420223127", "3423066291",
        "3448207668", "3457582636", "3464150065", "3469386677", "3472105798",
        "3472107711", "3484517078", "3488696470", "3495710469", "3499626246",
        "3502170557", "3512609469", "3519519035", "3520686759", "3553910307",
        "3576487666", "3584623791", "3590660678", "3590669459", "3591233084",
        "3593978288", "3597115108", "760760421"
    ]
    
    cache_file = Path.home() / ".l4d2_addon_names_cache.json"
    
    try:
        print("üîß –°–æ–∑–¥–∞–Ω–∏–µ –∫—ç—à–∞ –¥–ª—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–¥–¥–æ–Ω–æ–≤...")
        print(f"üìä –ê–¥–¥–æ–Ω–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: {len(unprocessed_addons)}")
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫—ç—à
        cache = {}
        if cache_file.exists():
            with open(cache_file, 'r', encoding='utf-8') as f:
                cache = json.load(f)
            print(f"üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫—ç—à —Å {len(cache)} –∑–∞–ø–∏—Å—è–º–∏")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å–∏ –¥–ª—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–¥–¥–æ–Ω–æ–≤
        added_count = 0
        for addon_id in unprocessed_addons:
            if addon_id not in cache:
                cache[addon_id] = {
                    'name': f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–¥–¥–æ–Ω {addon_id}",
                    'original_name': f"–ê–¥–¥–æ–Ω {addon_id}",
                    'timestamp': int(time.time()),
                    'status': 'unprocessed'
                }
                added_count += 1
                print(f"‚ûï –î–æ–±–∞–≤–ª–µ–Ω: {addon_id}")
            else:
                print(f"‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –µ—Å—Ç—å): {addon_id}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫—ç—à
        with open(cache_file, 'w', encoding='utf-8') as f:
            json.dump(cache, f, ensure_ascii=False, indent=2)
        
        print(f"\n‚úÖ –ö—ç—à —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {cache_file}")
        print(f"üìä –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: {len(cache)}")
        print(f"‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö: {added_count}")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
        statuses = {}
        for addon_data in cache.values():
            status = addon_data.get('status', 'unknown')
            statuses[status] = statuses.get(status, 0) + 1
        
        print(f"\nüìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º:")
        for status, count in statuses.items():
            status_emoji = {
                'available': '‚úÖ',
                'not_found': '‚ùå',
                'private': 'üîí',
                'unprocessed': '‚ùì',
                'unknown': '‚ùì'
            }.get(status, '‚ùì')
            print(f"   {status_emoji} {status}: {count}")
        
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫—ç—à–∞: {e}")
        import traceback
        traceback.print_exc()
        return False

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üîß –°–æ–∑–¥–∞–Ω–∏–µ –∫—ç—à–∞ –¥–ª—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∞–¥–¥–æ–Ω–æ–≤")
    print("=" * 50)
    
    if create_cache_for_unprocessed():
        print("\nüéâ –ö—ç—à —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!")
        print("\nüìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:")
        print("1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ L4D2 Addon Manager")
        print("2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É —Å–Ω–æ–≤–∞")
        print("3. –¢–µ–ø–µ—Ä—å –≤—Å–µ –∞–¥–¥–æ–Ω—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è")
        print("4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π")
        print("\nüí° –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≥—Ä–∞–º–º–∞ –±—É–¥–µ—Ç:")
        print("   ‚Ä¢ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞–¥–¥–æ–Ω—ã –ø–æ —á–∞—Å—Ç—è–º (–±–∞—Ç—á–∞–º–∏)")
        print("   ‚Ä¢ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–≤–µ—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤")
        print("   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è")
    else:
        print("\n‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞")

if __name__ == "__main__":
    main()